{% extends 'reports/base.html' %}
{% load static %}

{% block title %}Stock Level Report - Montclair Wardrobe{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-color: #2c3e50;
        --accent-color: #d4af37;
        --text-dark: #2c3e50;
        --text-light: #6c757d;
        --bg-light: #f8f9fa;
        --white: #ffffff;
        /* Modern Design Variables */
        --primary-dark: #0a0a0a;
        --secondary-dark: #1a1a1a;
        --accent-dark: #2a2a2a;
        --gold-accent: #d4af37;
        --gold-light: #f4e4a6;
        --text-primary: #ffffff;
        --text-secondary: #b0b0b0;
        --text-muted: #808080;
        --glass-bg: rgba(255, 255, 255, 0.05);
        --glass-border: rgba(255, 255, 255, 0.1);
        --success-color: #28a745;
        --warning-color: #ffc107;
        --danger-color: #dc3545;
    }

    .metrics-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .metric-card {
        background: var(--glass-bg);
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border-left: 5px solid var(--gold-accent);
        border: 1px solid var(--glass-border);
        transition: all 0.3s ease;
    }
    
    .metric-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(212, 175, 55, 0.2);
        border-color: rgba(212, 175, 55, 0.4);
    }
    
    .metric-icon {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: var(--gold-accent);
    }
    
    .metric-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }
    
    .metric-label {
        color: var(--text-secondary);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .inventory-value-card {
        background: linear-gradient(135deg, var(--gold-accent) 0%, var(--gold-light) 100%);
        padding: 2rem;
        border-radius: 15px;
        color: var(--primary-dark);
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(212, 175, 55, 0.2);
    }
    
    .inventory-value-card h4 {
        color: var(--primary-dark);
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .inventory-value-card .value {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-dark);
    }
    
    .export-section {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
    }
    
    .export-btn {
        flex: 1;
        min-width: 150px;
        padding: 1rem;
        background: linear-gradient(135deg, var(--gold-accent) 0%, var(--gold-light) 100%);
        color: var(--primary-dark);
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }
    
    .export-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(212, 175, 55, 0.4);
        color: var(--primary-dark);
        text-decoration: none;
    }
    
    .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .section-title i {
        color: var(--gold-accent);
    }
    
    .data-table {
        background: var(--glass-bg);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        margin-bottom: 2rem;
        border: 1px solid var(--glass-border);
    }
    
    .data-table table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .data-table thead {
        background: linear-gradient(135deg, var(--gold-accent) 0%, var(--gold-light) 100%);
        color: var(--primary-dark);
    }
    
    .data-table th {
        padding: 1.5rem;
        text-align: left;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 1px;
    }
    
    .data-table td {
        padding: 1.5rem;
        border-bottom: 1px solid var(--glass-border);
        color: var(--text-primary);
    }
    
    .data-table tbody tr:hover {
        background: rgba(212, 175, 55, 0.1);
    }
    
    .data-table tbody tr:last-child td {
        border-bottom: none;
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem;
        color: var(--text-secondary);
    }
    
    .back-button {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 1rem 2rem;
        background: rgba(212, 175, 55, 0.1);
        color: var(--gold-accent);
        border: 2px solid var(--gold-accent);
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
    }
    
    .back-button:hover {
        background: var(--gold-accent);
        color: var(--primary-dark);
    }
    
    .status-badge {
        display: inline-block;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }
</style>
{% endblock %}

{% block report_content %}
<div class="reports-header">
    <h1 class="reports-title">ðŸ“¦ Stock Level Report</h1>
    <p class="reports-subtitle">Current inventory status and low stock alerts</p>
</div>

<!-- Key Metrics -->
<div class="metrics-container">
    <div class="metric-card">
        <div class="metric-icon">
            <i class="fas fa-boxes"></i>
        </div>
        <div class="metric-value">{{ report_data.total_products }}</div>
        <div class="metric-label">Total Products</div>
    </div>
    
    <div class="metric-card">
        <div class="metric-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="metric-value">{{ report_data.in_stock }}</div>
        <div class="metric-label">In Stock</div>
    </div>
    
    <div class="metric-card">
        <div class="metric-icon">
            <i class="fas fa-times-circle"></i>
        </div>
        <div class="metric-value">{{ report_data.out_of_stock }}</div>
        <div class="metric-label">Out of Stock</div>
    </div>
    
    <div class="metric-card">
        <div class="metric-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="metric-value">{{ report_data.low_stock }}</div>
        <div class="metric-label">Low Stock</div>
    </div>
</div>

<!-- Inventory Value -->
<div class="inventory-value-card">
    <h4>ðŸ’° Total Inventory Value</h4>
    <div class="value">ZMW {{ report_data.total_inventory_value|floatformat:2 }}</div>
</div>

<!-- Export Options -->
<div class="export-section">
    <a href="{% url 'reports:export' %}?type=stock_level&format=csv" class="export-btn">
        <i class="fas fa-file-csv"></i> Export CSV
    </a>
    <a href="{% url 'reports:export' %}?type=stock_level&format=pdf" class="export-btn">
        <i class="fas fa-file-pdf"></i> Export PDF
    </a>
</div>

<!-- Low Stock Items -->
<div class="data-table">
    <div style="padding: 2rem; border-bottom: 1px solid #ecf0f1;">
        <h3 class="section-title">
            <i class="fas fa-bell"></i> Low Stock Items (â‰¤ {{ report_data.low_stock_threshold }} units)
        </h3>
    </div>
    <table>
        <thead>
            <tr>
                <th>Product Name</th>
                <th>Current Stock</th>
                <th>Unit Price</th>
                <th>Inventory Value</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for item in report_data.low_stock_items %}
            <tr>
                <td><strong>{{ item.name }}</strong></td>
                <td>
                    <span style="{% if item.current_stock == 0 %}color: #dc3545;{% elif item.current_stock <= 2 %}color: #ff9800;{% else %}color: #28a745;{% endif %} font-weight: 600; font-size: 1.1rem;">
                        {{ item.current_stock }}
                    </span>
                </td>
                <td>ZMW {{ item.price|floatformat:2 }}</td>
                <td><strong style="color: #667eea;">ZMW {{ item.inventory_value|floatformat:2 }}</strong></td>
                <td>
                    {% if item.current_stock == 0 %}
                        <span class="status-badge" style="background: #dc3545; color: white;">Out of Stock</span>
                    {% elif item.current_stock <= 2 %}
                        <span class="status-badge" style="background: #ff9800; color: white;">Critical</span>
                    {% else %}
                        <span class="status-badge" style="background: #ffc107; color: #333;">Low</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="empty-state">
                    <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 1rem; display: block; color: #28a745;"></i>
                    All products have adequate stock levels
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Back Button -->
<div style="text-align: center; margin-top: 3rem; margin-bottom: 2rem;">
    <a href="{% url 'reports:dashboard' %}" class="back-button">
        <i class="fas fa-arrow-left"></i> Back to Reports Dashboard
    </a>
</div>
{% endblock %}
