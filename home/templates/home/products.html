{% extends "base.html" %}
{% load static %}

{% block title %}Shop - EHC Marketplace{% endblock %}

{% block content %}
<!-- Product List Section -->
<section class="container py-5" style="margin-top: 60px;">
    <h1 class="text-center mb-4">Shop</h1>

    <!-- Category Filter -->
    <div class="row mb-4">
        <div class="col-12 col-md-6 offset-md-3">
            <form method="GET" action="{% url 'home:products' %}" class="d-flex">
                <select name="category" class="form-select me-2" onchange="this.form.submit()">
                    <option value="">All Categories</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>
                            {{ category.name }}
                        </option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn btn-primary">Filter</button>
            </form>
        </div>
    </div>

    <!-- Product Grid -->
    <div class="row">
        {% for product in products %}
            <div class="col-12 col-md-6 col-lg-4 mb-4">
                <div class="product-card">
                    <img src="{% if product.image %}{{ product.image.url }}{% else %}{% static 'images/product-placeholder.jpg' %}{% endif %}" 
                         alt="{{ product.name }}" class="product-img">
                    <h5 class="mt-3">{{ product.name }}</h5>
                    <p class="text-muted">{{ product.description|truncatewords:20 }}</p>
                    <p class="product-price">ZMW {{ product.price|floatformat:2 }}</p>
                    <div class="d-flex justify-content-center gap-2">
                        <a href="{% url 'home:product_detail' product.id %}" class="btn btn-primary">View Details</a>
                        <form action="{% url 'cart:add_to_cart' product.id %}" method="post" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-success" {% if not product.is_in_stock %}disabled{% endif %}>
                                Add to Cart
                            </button>
                        </form>
                        
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="col-12 text-center">
                <p class="text-muted">No products available in this category.</p>
            </div>
        {% endfor %}
    </div>
</section>
{% endblock %}

<!-- Custom Styles -->
{% block extra_css %}
<style>
    .product-card {
        transition: transform 0.3s ease;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 15px;
        text-align: center;
        background: #fff;
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .product-img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 5px;
    }

    .product-price {
        font-size: 1.2em;
        font-weight: bold;
        color: #28a745;
    }

    .navbar {
        z-index: 1000;
    }

    footer {
        padding: 1rem 0;
        background-color: #343a40;
        color: white;
        text-align: center;
    }

    /* Ensure the footer is always at the bottom if there is not enough content */
    html, body {
        height: 100%;
    }

    .content-wrapper {
        min-height: 100%;
        display: flex;
        flex-direction: column;
    }

    .main-content {
        flex: 1;
    }
</style>
{% endblock %}

<!-- Custom JavaScript (if needed) -->
{% block extra_js %}
<script>
    // Optional custom JavaScript for extra features or behavior
</script>
{% endblock %}
